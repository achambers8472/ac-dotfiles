#!/usr/bin/env bash

source ac-bash-preamble || exit 1

max_attempts=2
cooldown=10

while getopts ":n:" opt; do
    case "$opt" in
        n)
            max_attempts="$OPTARG"
            ;;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            exit 1
            ;;
    esac
done

shift $((OPTIND-1))

if [[ "$max_attempts" == 0 ]] ; then
    while ! "$@" ; do
        sleep "$cooldown"
    done
    exit 0
else
    for ((i=0;i!="$max_attempts";i++)) ; do
        if "$@" ; then exit 0 ; fi
        sleep "$cooldown"
    done
    exit 1
fi
