#!/usr/bin/env bash

source ac-bash-preamble || exit 1

tmpdir="$(mktemp --directory --tmpdir=.)"
for file in "$@"; do
    base="${file##*/}"
    base="${base%.*}"
    newfile="${tmpdir}/${base}.mp3"
    avconv -i "${file}" -f sox -threads auto - | \
	sox \
	--show-progress \
	--multi-threaded \
        -t sox - \
        --replay-gain track \
        --compression -2.2 \
        "${newfile}" \
        silence 1 0.1 0.1% \
        reverse silence 1 0.1 0.1% reverse \
        pad 1 1
done
