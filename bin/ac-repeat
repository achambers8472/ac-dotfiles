#!/usr/bin/env bash

source ac-bash-preamble || exit 1

n_repeats=0
cooldown=10

while getopts ":n:" opt; do
    case "$opt" in
        n)
            n_repeats="$OPTARG"
            ;;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            exit 1
            ;;
    esac
done

shift $((OPTIND-1))

if [[ "$n_repeats" == 0 ]] ; then
    while : ; do
        "$@"
        sleep "$cooldown"
    done
    exit 0
else
    "$@"
    for ((i=1;i!="$n_repeats";i++)) ; do
        sleep "$cooldown"
        "$@"
    done
    exit 0
fi