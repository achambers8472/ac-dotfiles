#!/usr/bin/env bash

source ac-bash-preamble || exit 1

tmpdir="$(mktemp --directory --tmpdir=.)"
for file in "$@"; do
    base="${file##*/}"
    base="${base%%.*}"
    newfile="${tmpdir}/${base}.mp3"
    sox \
        --show-progress \
		--multi-threaded \
        "${file}" \
        --replay-gain track \
        --compression -2.2 \
        "${newfile}" \
        silence 1 0.1 0.1% \
        reverse silence 1 0.1 0.1% reverse \
        pad 1 1
done
wait
