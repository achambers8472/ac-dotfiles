#!/usr/bin/env python

import sys
import re
import subprocess

n_tables = int(sys.argv[2])
n_table_rows = int(sys.argv[3])
aspect_ratio = 1.3

output = subprocess.check_output(["texcount", sys.argv[1]])

targets = [
    ("text_words", "Words in text: ([\d]+)"),
    ("header_words", "Words in headers: ([\d]+)"),
    ("caption_words", "Words outside text \(captions, etc\.\): ([\d]+)"),
    ("floats_tables_figures", "Number of floats/tables/figures: ([\d]+)"),
    ("math_inline", "Number of math inlines: ([\d]+)"),
    ("math_display", "Number of math displayed: ([\d]+)"),
    ]

summary = {}
for key, regex in targets:
    match = re.search(regex, output)
    if match:
        summary[key] = int(match.group(1))
    else:
        raise ValueError("No match for: " + regex)

print summary

total = (
    0.0
    + summary["text_words"]
    + summary["header_words"]
    + summary["caption_words"]
    + (summary["floats_tables_figures"] - n_tables)*(150.0/aspect_ratio + 20)
    + (n_tables)*13 + n_table_rows*6.5
    + summary["math_display"]*16
    )

print "Total:", total
